# innocent-task

## Описание
Реализована логика параллельных POST-запросов к двум эндпоинтам с условием: если первый ("медленный, но хороший") не отвечает за 30 секунд, возвращается результат второго ("быстрый, но не такой хороший"). Оба эндпоинта в задании возвращают 404, поэтому акцент сделан на обработке ошибок, параллельности и контроле времени.

## Реализация
- Использован `GuzzleHttp\Client` с асинхронными запросами (`postAsync`).
- Параллельность через `Promise\Utils::settle` для ожидания обоих результатов.
- Контроль времени с помощью `microtime()`: если первый запрос успевает за 30 секунд, берётся его результат, иначе — второго.
- Обработка ошибок: код устойчив к 404 и другим исключениям.

## Возможные проблемы
1. **Изначальные 404**  
   - Решение: Обработал через `settle`, адаптировал под новые эндпоинты.
2. **Разница в заголовках**  
   - Первый эндпоинт имеет `Authorization`, второй — нет.  
   - Решение: Сохранил эту разницу, как в `curl`, предполагая, что это влияет на "качество" ответа.
3. **Условие "оба не успели — ошибка"**  
   - Решение: Ошибка, если оба > 30 сек.
4. **Формат тела запроса**  
   - В `curl` — массив объектов (`[{...}]`), а не объект.  
   - Решение: Перенёс в Guzzle как `json => [['document_type' => 'ctc', ...]]`.
5. **Таймаут 25 сек в JSON**  
   - Подвох: `"timeout": 25` в JSON против 30 сек в условии.  
   - Решение: Использовал 30 сек по твоему условию, но отметил несоответствие. Если подвох в 25 сек, готов изменить `timeout => 25` и логику на `$elapsedTime <= 25`.


## Результаты
- Успех: Первый успел за 21.84 сек:(Если выставить таймаут = 25)
Если таймаут 30,то возвращает ошибку (Ошибка: оба эндпоинта провалились: Первый: timeout Второй: cURL error 28: Operation timed out after 30016 milliseconds with 0 bytes received (see https://curl.haxx.se/libcurl/c/libcurl-errors.html) for https://api.xn--80ajbekothchmme5j.xn--p1ai/gis-gate/api/v1/gis/search)



## Возможные улучшения
- Добавить unit-тесты для проверки логики (`PHPUnit`).
- Эмулировать задержки через тестовые эндпоинты (например, `httpbin.org/delay/40` и `5`).
- Логирование ошибок в файл через `Monolog`.
- Рефакторинг: вынести запросы в сервис-класс для читаемости.
