# innocent-task

## Описание
Реализована логика параллельных POST-запросов к двум эндпоинтам с условием: если первый ("медленный, но хороший") не отвечает за 30 секунд, возвращается результат второго ("быстрый, но не такой хороший"). Оба эндпоинта в задании возвращают 404, поэтому акцент сделан на обработке ошибок, параллельности и контроле времени.

## Реализация
- Использован `GuzzleHttp\Client` с асинхронными запросами (`postAsync`).
- Параллельность через `Promise\Utils::settle` для ожидания обоих результатов.
- Контроль времени с помощью `microtime()`: если первый запрос успевает за 30 секунд, берётся его результат, иначе — второго.
- Обработка ошибок: код устойчив к 404 и другим исключениям.

## Возможные проблемы
1. **Оба эндпоинта возвращают 404**  
   - Предположение: цель — не результат запросов, а логика обработки.  
   - Решение: Использовал `settle` вместо `all`, чтобы код не падал при ошибках, и вывел сообщения об исключениях.
2. **Разница в заголовках**  
   - Первый эндпоинт имеет `Authorization`, второй — нет.  
   - Решение: Сохранил эту разницу, как в `curl`, предполагая, что это влияет на "качество" ответа.
3. **Неоднозначность приоритета**  
   - Условие: "Если первый не ответил за 30 секунд" — но что, если оба успели?  
   - Решение: Дал приоритет первому ("хороший"), если он успевает, даже если второй быстрее.
4. **Формат тела запроса**  
   - В `curl` — массив объектов (`[{...}]`), а не объект.  
   - Решение: Перенёс в Guzzle как `json => [['document_type' => 'ctc', ...]]`.
5. **Таймаут и ошибки**  
   - Возможны 401, 403 из-за капчи/токена или сетевые сбои.  
   - Решение: `timeout => 30` в клиенте, обработка через `RequestException`.


## Возможные улучшения
- Добавить unit-тесты для проверки логики (`PHPUnit`).
- Эмулировать задержки через тестовые эндпоинты (например, `httpbin.org/delay/40` и `5`).
- Логирование ошибок в файл через `Monolog`.
- Рефакторинг: вынести запросы в сервис-класс для читаемости.
